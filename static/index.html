<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>WebCodecs Video Chat</title>
  <style>
    html {
      background: #342E37
    }

    .interlocutor {
      padding: 10px;
      background: #3C91E6;
      border-radius: 25px;
    }

    #selfie {
      padding: 10px;
      background: #9FD356;
      border-radius: 25px;
    }

    button {
      background-color: #555555;
      border: none;
      color: white;
      padding: 15px 32px;
      width: 150px;
      text-align: center;
      display: block;
      font-size: 16px;
    }
  </style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="main.js"></script>
  <script type="text/javascript">
    'use strict';

    async function main(arg) {
      let codec_string = 'vp8';
      codec_string = 'vp09.00.10.08';
      let width = 720;
      let height = 480;
      let constraints = {
        audio: false,
        video: {
          width: { ideal: width },
          height: { ideal: height },
          frameRate: 24
        }
      };
      let stream =
        await window.navigator.mediaDevices.getUserMedia(constraints);
      var track = stream.getTracks()[0];

      let settings = track.getSettings();
      let encoder_config = {
        codec: codec_string,
        height: height,
        width: width,
        bitrate: 1000000,
        frameRate: settings.frameRate
      };

      let decoder_config = {
        codec: codec_string,
        codedHeight: height,
        codedWidth: width,
        visibleRegion: { left: 0, top: 0, height: height, width: width }
      };

      let canvas_manager = new CanvasManager('videos');
      let server = new ServerSocket(track, encoder_config, canvas_manager);
      window.__server = server;
      server.setSelfieCanvas(document.getElementById('selfie'));
      server.processFrames();
    }

    window.onload = main;
  </script>
</head>

<body>
  <div id='videos'>
    <canvas id='selfie' width="720" height="480"></canvas>
  </div>
</body>

</html>