<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>WebCodecs Video Chat</title>
  <style>
    interlocutor {
      padding: 10px;
      background: gold;
    }
    #selfie {
      padding: 10px;
      background: lightseagreen;
    }

    button {
      background-color: #555555;
      border: none;
      color: white;
      padding: 15px 32px;
      width: 150px;
      text-align: center;
      display: block;
      font-size: 16px;
    }
  </style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="main.js"></script>
  <script type="text/javascript">
    'use strict';

    async function main(arg) {
      let codec_string = 'vp8';
      codec_string = 'vp09.00.10.08';
      let constraints = {
        audio: false,
        video: {
          width: { min: 720 },
          height: { min: 480 }
        }
      };
      let stream =
        await window.navigator.mediaDevices.getUserMedia(constraints);
      var track = stream.getTracks()[0];

      let settings = track.getSettings();
      let encoder_config = {
        codec: codec_string,
        height: settings.height,
        width: settings.width,
        bitrate: 600000,
        frameRate: settings.frameRate
      };

      let decoder_config = {
        codec: codec_string,
        codedHeight: settings.height,
        codedWidth: settings.width,
      };

      let canvas_manager = new CanvasManager('videos');
      let server = new ServerSocket(track, encoder_config, canvas_manager);
      window.__server = server;
      server.setSelfieCanvas(document.getElementById('selfie'));
      server.processFrames();
    }

    window.onload = main;
  </script>
</head>

<body>
  <div id='videos'>
    <canvas id='selfie' width="720" height="480"></canvas>
  </div>
</body>

</html>